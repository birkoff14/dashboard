{% extends "base.html" %}
{% load static %}
{% load crispy_forms_tags %}

{% block css%}

<!-- daterange picker -->
<link rel="stylesheet" href="{% static 'css/tagsinput.css' %}">

<link rel="stylesheet" href="{% static 'plugins/fontawesome-free/css/all.min.css' %}">

<link rel="stylesheet" href="{% static 'plugins/daterangepicker/daterangepicker.css' %}">

<link rel="stylesheet" href="{% static 'plugins/icheck-bootstrap/icheck-bootstrap.min.css' %}">

<link rel="stylesheet" href="{% static 'plugins/bootstrap-colorpicker/css/bootstrap-colorpicker.min.css' %}">

<link rel="stylesheet" href="{% static 'plugins/tempusdominus-bootstrap-4/css/tempusdominus-bootstrap-4.min.css' %}">

<link rel="stylesheet" href="{% static 'plugins/select2/css/select2.min.css' %}">
<link rel="stylesheet" href="{% static 'plugins/select2-bootstrap4-theme/select2-bootstrap4.min.css' %}">

<link rel="stylesheet" href="{% static 'plugins/bootstrap4-duallistbox/bootstrap-duallistbox.min.css' %}">

<link rel="stylesheet" href="{% static 'plugins/bs-stepper/css/bs-stepper.min.css' %}">

<link rel="stylesheet" href="{% static 'plugins/dropzone/min/dropzone.min.css' %}">

<link rel="stylesheet" href="{% static 'plugins/toastr/toastr.min.css' %}">
<!-- SweetAlert2 -->
<link rel="stylesheet" href="{% static 'plugins/sweetalert2-theme-bootstrap-4/bootstrap-4.min.css' %}">
{% endblock %}

{% block content %}

<section class="content">
    <div class="container-fluid">
        <div class="row">
            <!-- left column -->
            <div class="col-md-12">
                <div class="card card-primary">
                    <div class="card-header">
                        <h3 class="card-title"> {{ titulo }} </h3>
                    </div>
                    <form class="needs-validation" name="form1" action="#" method="POST">
                        <div class="card-body">
                            {% csrf_token %}
                            <div class="form-group">
                                <label>Tipo de actividad</label>
                                <select name="cmbActividad" class="form-control select2bs4 select" style="width: 100%;" id="cmbActividad">
                                    <option selected="0">------------------------</option>
                                    <option value="99999">Sin SR asociado</option>
                                    {% for dt in qry %}
                                    <option value="{{ dt.SR }}">{{ dt.SR }}</option>
                                    {% endfor %}
                                </select>
                                <input type="hidden" name="usuario" value="{{ user.username }}">
                            </div>
                            <div class="form-group">
                                <label>Solicitante de la tarea</label>
                                <select id="txtSolicitante" name="txtSolicitante" class="form-control select" style="width: 100%;">
                                    <option selected="0">------------------------</option>
                                    <option>Adrián Martínez</option>
                                    <option>Luis Alberto Ramírez</option>
                                    <option>Rodolfo Mena</option>
                                    <option>TEAM OAC</option>
                                    <option>------------------------</option>
                                    <option>Turnos</option>
                                    <option>Mesa de ayuda</option>
                                    <option>ITOC</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <div id="NombreTurnos"></div>
                            </div> 
                            <div class="form-group">
                                <label>Evento o proyecto</label>
                                <select name="cmbTipo" class="form-control select" style="width: 100%;" id="cmbTipo">
                                    <option selected="0">------------------------</option>
                                    <option>Evento</option>
                                    <option>Proyecto</option>
                                </select>
                            </div>  
                            <div id="SR_ID" class="form-group">
                                <label>Ambiente</label>
                                <select name="Ambiente" class="form-control select" style="width: 100%;" id="Ambiente">
                                    <option selected="0">------------------------</option>                                    
                                    {% for dt in env %}
                                    <option value="{{ dt.NombreAmbiente }}">{{ dt.NombreAmbiente }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Status</label>
                                <select name="Status" class="form-control select" style="width: 100%;">
                                    <option selected="0">------------------------</option>
                                    <option value="En proceso">En proceso</option>
                                    <option value="Terminado">Terminado</option>
                                </select>                                
                            </div>
                            <div class="form-group">
                                <div id="desc"></div>
                            </div> 
                            <div class="form-group">
                                <label>Avance</label>
                                <input type='text' class='form-control' name='Avance'>                            
                            </div>                            
                            <div class="form-group">
                                <div id="IM"></div>
                            </div>
                            <div class="form-group">
                                <div id="RFC"></div>
                            </div>
                            <div class="form-group">
                                <div id=""></div>
                            </div>                                                       
                            <div class="form-group">
                                <label>Fecha inicio</label>
                                <div class="input-group date" id="reservationdate" data-target-input="nearest">
                                    <input name="fInicio" type="text" class="form-control datetimepicker-input"
                                        data-target="#reservationdate">
                                    <div class="input-group-append" data-target="#reservationdate"
                                        data-toggle="datetimepicker">
                                        <div class="input-group-text"><i class="far fa-calendar-alt"></i></div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Fecha finalización</label>
                                <div class="input-group date" id="reservationdate2" data-target-input="nearest">
                                    <input name="fFin" type="text" class="form-control datetimepicker-input"
                                        data-target="#reservationdate2">
                                    <div class="input-group-append" data-target="#reservationdate2"
                                        data-toggle="datetimepicker">
                                        <div class="input-group-text"><i class="far fa-calendar-alt"></i></div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Horas invertidas</label>
                                <input name="txtHorasInvertidas" type="text" class="form-control">
                            </div>                            
                            <input type="submit" name="submit" class='btn btn-primary swalDefaultSuccess'
                                id="submit_btn" value="Agregar datos" />
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</section>

{% endblock %}

{% block js %}

<!-- AdminLTE dashboard demo (This is only for demo purposes)
<script src="{% static 'js/pages/dashboard3.js' %}"></script> -->

<script src="{% static 'js/tagsinput.js' %}"></script>

<!-- date-range-picker -->
<script src="{% static 'plugins/select2/js/select2.full.min.js' %}"></script>

<script src="{% static 'plugins/bootstrap4-duallistbox/jquery.bootstrap-duallistbox.min.js' %}"></script>

<script src="{% static 'plugins/moment/moment.min.js' %}"></script>
<script src="{% static 'plugins/inputmask/jquery.inputmask.min.js' %}"></script>

<script src="{% static 'plugins/daterangepicker/daterangepicker.js' %}"></script>

<script src="{% static 'plugins/bootstrap-colorpicker/js/bootstrap-colorpicker.min.js' %}"></script>

<script src="{% static 'plugins/tempusdominus-bootstrap-4/js/tempusdominus-bootstrap-4.min.js' %}"></script>

<script src="{% static 'plugins/bootstrap-switch/js/bootstrap-switch.min.js' %}"></script>

<script src="{% static 'plugins/bs-stepper/js/bs-stepper.min.js' %}"></script>

<script src="{% static 'plugins/dropzone/min/dropzone.min.js' %}"></script>

<!-- Toastr -->
<script src="{% static 'plugins/toastr/toastr.min.js' %}"></script>
<!-- SweetAlert2 -->
<script src="{% static 'plugins/sweetalert2/sweetalert2.min.js' %}"></script>


<script>
    $(function () {

        var Toast = Swal.mixin({
            toast: true,
            position: 'top-end',
            showConfirmButton: false,
            timer: 30000
        });

        $('.swalDefaultSuccess').click(function () {
            Toast.fire({
                icon: 'success',
                title: 'Se agregó la actividad exitosamente'
            })
        });

        //Initialize Select2 Elements
        $('.select2').select2()

        //Initialize Select2 Elements
        $('.select2bs4').select2({
            theme: 'bootstrap4'
        })

        //Datemask dd/mm/yyyy
        $('#datemask').inputmask('dd/mm/yyyy', { 'placeholder': 'dd/mm/yyyy' })
        //Datemask2 mm/dd/yyyy
        $('#datemask2').inputmask('mm/dd/yyyy', { 'placeholder': 'mm/dd/yyyy' })
        //Money Euro
        $('[data-mask]').inputmask()

        //Date picker
        $('#reservationdate').datetimepicker({
            //format: 'L'
            format: 'YYYY-MM-DD'
        });

        $('#reservationdate2').datetimepicker({
            //format: 'L'
            format: 'YYYY-MM-DD'
        });

        //Date and time picker
        $('#reservationdatetime').datetimepicker({ icons: { time: 'far fa-clock' } });

        //Date range picker
        $('#reservation').daterangepicker()
        //Date range picker with time picker
        $('#reservationtime').daterangepicker({
            timePicker: true,
            timePickerIncrement: 30,
            locale: {
                format: 'MM/DD/YYYY hh:mm A'
            }
        })
        //Date range as a button
        $('#daterange-btn').daterangepicker(
            {
                ranges: {
                    'Today': [moment(), moment()],
                    'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
                    'Last 7 Days': [moment().subtract(6, 'days'), moment()],
                    'Last 30 Days': [moment().subtract(29, 'days'), moment()],
                    'This Month': [moment().startOf('month'), moment().endOf('month')],
                    'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
                },
                startDate: moment().subtract(29, 'days'),
                endDate: moment()
            },
            function (start, end) {
                $('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'))
            }
        )

        //Timepicker
        $('#timepicker').datetimepicker({
            format: 'LT'
        })

        //Bootstrap Duallistbox
        $('.duallistbox').bootstrapDualListbox()

        //Colorpicker
        $('.my-colorpicker1').colorpicker()
        //color picker with addon
        $('.my-colorpicker2').colorpicker()

        $('.my-colorpicker2').on('colorpickerChange', function (event) {
            $('.my-colorpicker2 .fa-square').css('color', event.color.toString());
        })

        $("input[data-bootstrap-switch]").each(function () {
            $(this).bootstrapSwitch('state', $(this).prop('checked'));
        })

        //$(document).on("change", "#cmbActividad", function () {
        $('#cmbActividad').change(function () {
            var value = $(this).val();
            if (value == 99999) {                
                var input = "<input type='text' class='form-control' name='IM'>";
                $("#IM")
                    .html('<label>IM</label>')
                    .append(input)
                    .show()
                //$(this).next('text_area_appended_here').html(input);
                var input2 = "<input type='text' class='form-control' name='Descripcion'>";
                $("#desc")
                    .html('<label><div id="PROYECTO">Descripcion actividad</div></label>')
                    .append(input2)
                    .show()
                var input3 = "<input type='text' class='form-control' name='RFC'>";
                $("#RFC")
                    .html('<label>RFC</label>')
                    .append(input3)
                    .show()
                var input4 = "<input type='text' class='form-control' name='SR'>";
                $("#SR_ID").show()
                    //.html('<label>SR</label>')
                    //.append(input4)
                    //.show()
            }
            else {
                $("#IM").hide()
                $("#desc").hide()
                $("#RFC").hide()
                $("#SR_ID").hide()

            }
        });

        $('#cmbTipo').change(function () {
            var value = $(this).val();
            if (value == "Proyecto") {
                $("#PROYECTO")
                    .html('Descripción del subject del correo')
                    //.append(input)
                    .show()
                $("#")
            }else{
                $("#PROYECTO")
                    .html('Descripción actividad')
                    //.append(input)
                    .show()
            }
        });    
        
        $('#txtSolicitante').change(function () {
            var value = $(this).val();
            var input5 = "<input type='text' class='form-control' name='NombreTurnos'>";
            if (value == "Turnos" || value == "Mesa de ayuda" || value == "TEAM OAC" || value == "ITOC") {
                $("#NombreTurnos")
                    .html('Nombre contacto')
                    .append(input5)
                    .show()
                $("#")
            }else{
                $('#NombreTurnos').hide()
            }
        }); 


    });
</script>

{% endblock %}